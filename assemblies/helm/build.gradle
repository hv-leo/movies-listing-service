description = "movies-listing-service helm chart"
import org.apache.tools.ant.filters.ReplaceTokens

task replaceChartValues(type: Copy) {
    from './chart'
     filter(ReplaceTokens, tokens: [replica_count: rootProject.ext.replica_count,
                                    server_image_name: rootProject.ext.server_image_name,
                                    client_image_name: rootProject.ext.client_image_name,
                                    server_container_port: rootProject.ext.server_container_port,
                                    client_container_port: rootProject.ext.client_container_port,
                                    server_service_name: rootProject.ext.server_service_name,
                                    client_service_name: rootProject.ext.client_service_name,
                                    server_service_port: rootProject.ext.server_service_port,
                                    client_service_port: rootProject.ext.client_service_port,
                                    ingress_enabled: rootProject.ext.ingress_enabled,
                                    ingress_host: rootProject.ext.ingress_host,
                                    server_root_path: rootProject.ext.server_root_path,
                                    client_root_path: rootProject.ext.client_root_path,
                                    autoscaling_enabled: rootProject.ext.autoscaling_enabled,
                                    autoscaling_min_replicas: rootProject.ext.autoscaling_min_replicas,
                                    autoscaling_max_replicas: rootProject.ext.autoscaling_max_replicas,
                                    autoscaling_target_cpu_utilization_percentage: rootProject.ext.autoscaling_target_cpu_utilization_percentage])
     into './build/chart'
}

task helmChartPackage(type:Exec) {
    dependsOn("replaceChartValues")
    workingDir "./build"
    commandLine "helm", "package", "chart", "-d", "${buildDir}",
                "--app-version", "${version}", "--version", "${version}"
}