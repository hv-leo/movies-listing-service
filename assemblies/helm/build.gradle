description = "movies-listing-service helm chart"
import org.apache.tools.ant.filters.ReplaceTokens

task replaceChartValues(type: Copy) {
    from './chart'
     filter(ReplaceTokens, tokens: [replicaCount: rootProject.ext.replicaCount,
                                    serverImgName: rootProject.ext.serverImgName,
                                    serverContainerPort: rootProject.ext.serverContainerPort,
                                    serverServiceName: rootProject.ext.serverServiceName,
                                    serverServicePort: rootProject.ext.serverServicePort,
                                    serverServiceTargetPort: rootProject.ext.serverServiceTargetPort,
                                    ingress_enabled: rootProject.ext.ingress_enabled,
                                    ingress_host: rootProject.ext.ingress_host,
                                    SERVER_ROOT_PATH: rootProject.ext.SERVER_ROOT_PATH,
                                    serverIngressPort: rootProject.ext.serverIngressPort,
                                    autoescaling_enabled: rootProject.ext.autoescaling_enabled,
                                    autoescaling_minReplicas: rootProject.ext.autoescaling_minReplicas,
                                    autoescaling_maxReplicas: rootProject.ext.autoescaling_maxReplicas,
                                    autoescaling_targetCPUUtilizationPercentage: rootProject.ext.autoescaling_targetCPUUtilizationPercentage])
     into './build/chart'
}

task helmChartPackage(type:Exec) {
    dependsOn("replaceChartValues")
    workingDir "./build"
    commandLine "helm", "package", "chart", "-d", "${buildDir}",
                "--app-version", "${version}", "--version", "${version}"
}